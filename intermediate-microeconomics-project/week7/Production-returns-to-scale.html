<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Mini EconGraphs Demo</title>
  <link rel="stylesheet" href="../assets/site.css">
  <link rel="stylesheet" href="../assets/graph.css?v=3">
</head>
<body class="graph-page">
  <div id="navbar-container"></div>
  <script src="../assets/navbarG-loader.js"></script>
  <script src="/intermediate-microeconomics-project/explanations.js?v=5"></script>
  
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const boxes = document.querySelectorAll("[data-explain-id]");
      boxes.forEach(function (box) {
        const id = box.dataset.explainId;
        if (typeof EXPLANATIONS !== "undefined" && EXPLANATIONS[id]) {
          box.innerHTML = EXPLANATIONS[id];
        } else {
          console.warn("Missing explanation for id:", id);
        }
      });
    });
  </script>

  <div class="container">
    <h1>Production & Return to scale</h1>

    <section class="section">
      <div class="section-header">
        <h2>üìà Interactive Graph</h2>
        <a
          class="desmos-btn"
          data-desmos-id="Production-returns-to-scale"
          target="_blank"
          rel="noopener"
        >
          Open in Desmos
        </a>
      </div>
      <div class="graph-scroll">
        <div class="graph-resizable" id="graphBox">
          <div class="graph-wrapper">
            <iframe 
              src="https://www.desmos.com/calculator/6mne6a1bqi?embed" 
              width="100%" 
              height="100%" 
              style="border: 1px solid #ccc" 
              frameborder="0">
            </iframe>
          </div>
          <div class="resize-handle" aria-hidden="true" title="Drag to resize"></div>
        </div>
      </div>
    </section>

    <section class="section">
      <h2>üé• Video</h2>
      <div class="video-frame" data-video-id="Production-returns-to-scale"></div>
    </section>

    <section class="section">
      <h2>üìò Production & Return to scale</h2>
      <div class="textbox" data-explain-id="Production-returns-to-scale"></div>
    </section>
  </div>

  <script>
    // ‰øùÁïôÊãñÊãΩÁº©ÊîæÈÄªËæëÔºå‰ΩÜÁßªÈô§‰∫ÜÂØπ window.calc3d ÁöÑË∞ÉÁî®
    document.addEventListener("pointerdown", (e) => {
      const handle = e.target.closest('.resize-handle');
      if (!handle) return;

      e.preventDefault();
      
      const graphBox = document.getElementById("graphBox");
      const container = document.querySelector(".container");
      
      let startX = e.clientX;
      let startY = e.clientY;
      let startW = container.offsetWidth;
      let startH = graphBox.offsetHeight;

      function onMove(moveEvent) {
        const newW = startW + (moveEvent.clientX - startX);
        const newH = startH + (moveEvent.clientY - startY);
        
        container.style.width = Math.max(600, newW) + "px";
        container.style.maxWidth = "none";
        graphBox.style.height = Math.max(400, newH) + "px";
        
        // iframe ‰ºöÈöèÁà∂ÂÆπÂô®Ëá™Âä®Ë∞ÉÊï¥Â§ßÂ∞èÔºåÊó†ÈúÄÈ¢ùÂ§ñ resize() Ë∞ÉÁî®
      }

      function onUp() {
        window.removeEventListener("pointermove", onMove);
        window.removeEventListener("pointerup", onUp);
      }

      window.addEventListener("pointermove", onMove);
      window.addEventListener("pointerup", onUp);
    });
  </script>

  <script src="/intermediate-microeconomics-project/desmos-links.js"></script>
  <script src="/intermediate-microeconomics-project/video.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const boxes = document.querySelectorAll("[data-explain-id]");
      boxes.forEach(function (box) {
        const id = box.dataset.explainId;
        if (typeof EXPLANATIONS !== "undefined" && EXPLANATIONS[id]) {
          box.innerHTML = EXPLANATIONS[id];
        } else {
          console.warn("Missing explanation for id:", id);
        }
      });
    });
  </script>
  
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const btns = document.querySelectorAll("[data-desmos-id]");
      btns.forEach(btn => {
        const id = btn.dataset.desmosId;
        if (DESMOS_LINKS[id]) {
          btn.href = DESMOS_LINKS[id].url;
          btn.textContent = DESMOS_LINKS[id].title || "Open in Desmos";
        } else {
          console.warn("Missing Desmos link for:", id);
        }
      });
    });
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const containers = document.querySelectorAll("[data-video-id]");
      containers.forEach(container => {
        const id = container.dataset.videoId;
        if (VIDEOS[id]) {
          container.innerHTML = `
            <iframe
              src="${VIDEOS[id].src}"
              title="${VIDEOS[id].title || ""}"
              allowfullscreen
            ></iframe>
          `;
        } else {
          console.warn("Missing video for:", id);
        }
      });
    });
  </script>
</body>
</html>
